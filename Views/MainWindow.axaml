<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:NetKeyer.ViewModels"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:res="clr-namespace:NetKeyer.Resources.Strings"
        mc:Ignorable="d" d:DesignWidth="600" d:DesignHeight="500"
        x:Class="NetKeyer.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Title="{x:Static res:Resources.MainWindow_Title}"
        Width="600" Height="640"
        MinWidth="500" MinHeight="540">

    <Design.DataContext>
        <vm:MainWindowViewModel/>
    </Design.DataContext>

    <DockPanel>
        <!-- Menu Bar (hidden on macOS, where we use the native menu bar) -->
        <Menu DockPanel.Dock="Top" IsVisible="{Binding IsMenuBarInWindow}">
            <MenuItem Header="{x:Static res:Resources.Menu_File}">
                <MenuItem Header="{x:Static res:Resources.Menu_File_Exit}" Command="{Binding ExitCommand}"/>
            </MenuItem>
            <MenuItem Header="{x:Static res:Resources.Menu_Settings}">
                <MenuItem Header="{x:Static res:Resources.Menu_Settings_AudioDevice}" Command="{Binding SelectAudioDeviceCommand}"/>
                <MenuItem Header="{x:Static res:Resources.Menu_Settings_MidiMapping}" Command="{Binding ConfigureMidiNotesCommand}"/>
            </MenuItem>
            <MenuItem Header="{x:Static res:Resources.Menu_Help}">
                <MenuItem Header="{x:Static res:Resources.Menu_Help_Documentation}" Command="{Binding OpenDocumentationCommand}"/>
                <MenuItem Header="{x:Static res:Resources.Menu_Help_ViewDebugLog}" Command="{Binding OpenDebugLogCommand}"/>
                <MenuItem Header="{x:Static res:Resources.Menu_Help_About}" Command="{Binding ShowAboutCommand}"/>
            </MenuItem>
        </Menu>

        <!-- Main Content -->
        <ScrollViewer>
            <StackPanel Margin="10" Spacing="8">

                <!-- Setup Page -->
                <StackPanel Spacing="8" IsVisible="{Binding IsSetupPage}">

                    <!-- SmartLink Section -->
                    <Border BorderBrush="Gray" BorderThickness="1" Padding="8" CornerRadius="3"
                            IsVisible="{Binding SmartLinkAvailable}">
                        <StackPanel Spacing="6">
                            <TextBlock Text="{x:Static res:Resources.SmartLink_Title}" FontWeight="Bold" FontSize="14"/>

                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <Button Content="{Binding SmartLinkButtonText}"
                                        Command="{Binding ToggleSmartLinkCommand}"
                                        Width="180"
                                        HorizontalContentAlignment="Center"
                                        Padding="4"/>
                                <TextBlock Text="{Binding SmartLinkStatus}"
                                           VerticalAlignment="Center"
                                           FontSize="12"/>
                            </StackPanel>
                        </StackPanel>
                    </Border>

                    <!-- Radio Selection -->
                    <Border BorderBrush="Gray" BorderThickness="1" Padding="8" CornerRadius="3">
                        <StackPanel Spacing="6">
                            <TextBlock Text="{x:Static res:Resources.RadioSelection_Title}" FontWeight="Bold" FontSize="14"/>

                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <ComboBox Name="RadioComboBox"
                                          ItemsSource="{Binding RadioClientSelections}"
                                          SelectedItem="{Binding SelectedRadioClient}"
                                          Width="450"
                                          PlaceholderText="{x:Static res:Resources.RadioSelection_Placeholder}"/>
                                <Button Content="{x:Static res:Resources.Common_Refresh}"
                                        Command="{Binding RefreshRadiosCommand}"
                                        Width="70"
                                        HorizontalContentAlignment="Center"
                                        Padding="4"/>
                            </StackPanel>

                            <!-- Status - only shown on error -->
                            <TextBlock Text="{Binding RadioStatus}"
                                       Foreground="{Binding RadioStatusColor}"
                                       IsVisible="{Binding HasRadioError}"
                                       TextWrapping="Wrap"/>
                        </StackPanel>
                    </Border>

                    <!-- Input Device Selection -->
                    <Border BorderBrush="Gray" BorderThickness="1" Padding="8" CornerRadius="3">
                        <StackPanel Spacing="6">
                            <TextBlock Text="{x:Static res:Resources.InputDevice_Title}" FontWeight="Bold" FontSize="14"/>

                            <!-- Input Type Selector -->
                            <StackPanel Spacing="3">
                                <TextBlock Text="{x:Static res:Resources.InputDevice_Type}" FontSize="12"/>
                                <StackPanel Orientation="Horizontal" Spacing="15">
                                    <RadioButton Content="{x:Static res:Resources.InputDevice_SerialPort}"
                                                 GroupName="InputType"
                                                 IsChecked="{Binding IsSerialInput}"
                                                 Padding="2"/>
                                    <RadioButton Content="{x:Static res:Resources.InputDevice_Midi}"
                                                 GroupName="InputType"
                                                 IsChecked="{Binding IsMidiInput}"
                                                 Padding="2"/>
                                </StackPanel>
                            </StackPanel>

                            <!-- Serial Port Settings -->
                            <StackPanel Spacing="6" IsVisible="{Binding IsSerialInput}">
                                <StackPanel Orientation="Horizontal" Spacing="6">
                                    <TextBlock Text="{x:Static res:Resources.InputDevice_Port}" VerticalAlignment="Center" Width="110"/>
                                    <ComboBox ItemsSource="{Binding SerialPorts}"
                                              SelectedItem="{Binding SelectedSerialPort}"
                                              Width="280"
                                              PlaceholderText="{x:Static res:Resources.InputDevice_PortPlaceholder}"/>
                                    <Button Content="{x:Static res:Resources.Common_Refresh}"
                                            Command="{Binding RefreshSerialPortsCommand}"
                                            Width="70"
                                            HorizontalContentAlignment="Center"
                                            Padding="4"/>
                                </StackPanel>
                            </StackPanel>

                            <!-- MIDI Device Settings -->
                            <StackPanel Spacing="6" IsVisible="{Binding IsMidiInput}">
                                <StackPanel Orientation="Horizontal" Spacing="6">
                                    <TextBlock Text="{x:Static res:Resources.InputDevice_MidiDevice}" VerticalAlignment="Center" Width="100"/>
                                    <ComboBox ItemsSource="{Binding MidiDevices}"
                                              SelectedItem="{Binding SelectedMidiDevice}"
                                              Width="280"
                                              PlaceholderText="{x:Static res:Resources.InputDevice_MidiPlaceholder}"/>
                                    <Button Content="{x:Static res:Resources.Common_Refresh}"
                                            Command="{Binding RefreshMidiDevicesCommand}"
                                            Width="70"
                                            HorizontalContentAlignment="Center"
                                            Padding="4"/>
                                </StackPanel>
                            </StackPanel>
                        </StackPanel>
                    </Border>

                    <!-- Connect Button -->
                    <Button Content="{x:Static res:Resources.Button_Connect}"
                            Command="{Binding ToggleConnectionCommand}"
                            HorizontalAlignment="Center"
                            HorizontalContentAlignment="Center"
                            Width="120"
                            Padding="6"
                            Margin="0,5,0,0"/>
                </StackPanel>

                <!-- Operating Page -->
                <StackPanel Spacing="8" IsVisible="{Binding IsOperatingPage}">

                    <!-- Paddle Status -->
                    <Border BorderBrush="Gray" BorderThickness="1" Padding="8" CornerRadius="3">
                        <StackPanel Spacing="6">
                            <TextBlock Text="{x:Static res:Resources.KeyStatus_Title}" FontWeight="Bold" FontSize="14"/>

                            <StackPanel Orientation="Horizontal" Spacing="15" HorizontalAlignment="Center">
                                <!-- Left Paddle/Key/PTT Indicator -->
                                <StackPanel Spacing="3">
                                    <TextBlock Text="{Binding LeftPaddleLabelText}"
                                               FontSize="11"
                                               FontWeight="Bold"
                                               HorizontalAlignment="Center"/>
                                    <Border Width="80" Height="40"
                                            Background="{Binding LeftPaddleIndicatorColor}"
                                            BorderBrush="DarkGray"
                                            BorderThickness="2"
                                            CornerRadius="3">
                                        <TextBlock Text="{Binding LeftPaddleStateText}"
                                                   HorizontalAlignment="Center"
                                                   VerticalAlignment="Center"
                                                   Foreground="White"
                                                   FontWeight="Bold"
                                                   FontSize="14"/>
                                    </Border>
                                </StackPanel>

                                <!-- Right Paddle Indicator (conditional) -->
                                <StackPanel Spacing="3" IsVisible="{Binding RightPaddleVisible}">
                                    <TextBlock Text="{x:Static res:Resources.KeyStatus_RightPaddle}"
                                               FontSize="11"
                                               FontWeight="Bold"
                                               HorizontalAlignment="Center"/>
                                    <Border Width="80" Height="40"
                                            Background="{Binding RightPaddleIndicatorColor}"
                                            BorderBrush="DarkGray"
                                            BorderThickness="2"
                                            CornerRadius="3">
                                        <TextBlock Text="{Binding RightPaddleStateText}"
                                                   HorizontalAlignment="Center"
                                                   VerticalAlignment="Center"
                                                   Foreground="White"
                                                   FontWeight="Bold"
                                                   FontSize="14"/>
                                    </Border>
                                </StackPanel>
                            </StackPanel>
                        </StackPanel>
                    </Border>

                    <!-- Radio Mode Indicator -->
                    <Border BorderBrush="Gray" BorderThickness="1" Padding="8" CornerRadius="3">
                        <StackPanel Spacing="4">
                            <TextBlock Text="{Binding ConnectedRadioDisplay}"
                                       FontSize="14"
                                       HorizontalAlignment="Center"
                                       IsVisible="{Binding !!ConnectedRadioDisplay}"/>
                            <TextBlock Text="{Binding ModeDisplay}"
                                       FontSize="13"
                                       HorizontalAlignment="Center"/>

                            <!-- Mode switching instructions (conditional) -->
                            <TextBlock Text="{Binding ModeInstructions}"
                                       FontSize="11"
                                       Foreground="Orange"
                                       TextWrapping="Wrap"
                                       HorizontalAlignment="Center"
                                       IsVisible="{Binding !!ModeInstructions}"/>
                        </StackPanel>
                    </Border>

                    <!-- CW Settings Section -->
                    <Border BorderBrush="Gray" BorderThickness="1" Padding="8" CornerRadius="3"
                            IsVisible="{Binding CwSettingsVisible}">
                        <StackPanel Spacing="6">
                            <TextBlock Text="{x:Static res:Resources.CWSettings_Title}" FontWeight="Bold" FontSize="14"/>

                            <!-- Speed -->
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <TextBlock Text="{x:Static res:Resources.CWSettings_Speed}" Width="100" VerticalAlignment="Center"/>
                                <TextBlock Text="{Binding CwSpeed}" Width="25" VerticalAlignment="Center"/>
                                <Slider Minimum="5" Maximum="60"
                                        Value="{Binding CwSpeed}"
                                        TickFrequency="5"
                                        Width="250"
                                        VerticalAlignment="Center"/>
                            </StackPanel>

                            <!-- Sidetone Volume -->
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <TextBlock Text="{x:Static res:Resources.CWSettings_Sidetone}" Width="100" VerticalAlignment="Center"/>
                                <TextBlock Text="{Binding SidetoneVolume}" Width="25" VerticalAlignment="Center"/>
                                <Slider Minimum="0" Maximum="100"
                                        Value="{Binding SidetoneVolume}"
                                        TickFrequency="10"
                                        Width="250"
                                        VerticalAlignment="Center"/>
                            </StackPanel>

                            <!-- Pitch -->
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <TextBlock Text="{x:Static res:Resources.CWSettings_Pitch}" Width="100" VerticalAlignment="Center"/>
                                <TextBlock Text="{Binding CwPitch}" Width="25" VerticalAlignment="Center"/>
                                <Slider Minimum="300" Maximum="1000"
                                        Value="{Binding CwPitch}"
                                        TickFrequency="50"
                                        Width="250"
                                        VerticalAlignment="Center"/>
                            </StackPanel>

                            <!-- Mode Selection -->
                            <StackPanel Spacing="3">
                                <TextBlock Text="{x:Static res:Resources.CWSettings_KeyerMode}" FontSize="12"/>
                                <StackPanel Orientation="Horizontal" Spacing="15">
                                    <RadioButton Content="{x:Static res:Resources.CWSettings_Iambic}"
                                                 GroupName="KeyerMode"
                                                 IsChecked="{Binding IsIambicMode}"
                                                 Padding="2"/>
                                    <RadioButton Content="{x:Static res:Resources.CWSettings_StraightKey}"
                                                 GroupName="KeyerMode"
                                                 IsChecked="{Binding !IsIambicMode}"
                                                 Padding="2"/>
                                </StackPanel>
                            </StackPanel>

                            <!-- Iambic Mode Selection (A vs B) -->
                            <StackPanel Spacing="3">
                                <TextBlock Text="{x:Static res:Resources.CWSettings_IambicType}" FontSize="12"/>
                                <StackPanel Orientation="Horizontal" Spacing="15">
                                    <RadioButton Content="{x:Static res:Resources.CWSettings_ModeA}"
                                                 GroupName="IambicType"
                                                 IsChecked="{Binding !IsIambicModeB}"
                                                 IsEnabled="{Binding IsIambicMode}"
                                                 Padding="2"/>
                                    <RadioButton Content="{x:Static res:Resources.CWSettings_ModeB}"
                                                 GroupName="IambicType"
                                                 IsChecked="{Binding IsIambicModeB}"
                                                 IsEnabled="{Binding IsIambicMode}"
                                                 Padding="2"/>
                                </StackPanel>
                            </StackPanel>

                            <!-- Swap Paddles -->
                            <CheckBox Content="{x:Static res:Resources.CWSettings_SwapPaddles}"
                                      IsChecked="{Binding SwapPaddles}"
                                      Padding="2"/>
                        </StackPanel>
                    </Border>

                    <!-- Disconnect and Exit Buttons -->
                    <StackPanel Orientation="Horizontal" Spacing="10" HorizontalAlignment="Center" Margin="0,5,0,0">
                        <Button Content="{x:Static res:Resources.Button_Disconnect}"
                                Command="{Binding ToggleConnectionCommand}"
                                HorizontalContentAlignment="Center"
                                Width="120"
                                Padding="6"/>
                        <Button Content="{x:Static res:Resources.Button_Exit}"
                                Command="{Binding ExitCommand}"
                                HorizontalContentAlignment="Center"
                                Width="100"
                                Padding="6"/>
                    </StackPanel>
                </StackPanel>

                <!-- Exit Button (Setup page only) -->
                <Button Content="{x:Static res:Resources.Button_Exit}"
                        Command="{Binding ExitCommand}"
                        IsVisible="{Binding IsSetupPage}"
                        HorizontalAlignment="Center"
                        HorizontalContentAlignment="Center"
                        Width="100"
                        Padding="6"
                        Margin="0,5,0,0"/>

            </StackPanel>
        </ScrollViewer>
    </DockPanel>

</Window>
