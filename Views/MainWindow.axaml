<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:NetKeyer.ViewModels"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d" d:DesignWidth="600" d:DesignHeight="500"
        x:Class="NetKeyer.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Title="NetKeyer - FlexRadio CW Keyer"
        Width="700" Height="700"
        MinWidth="600" MinHeight="600">

    <Design.DataContext>
        <vm:MainWindowViewModel/>
    </Design.DataContext>

    <ScrollViewer>
        <StackPanel Margin="20" Spacing="15">

            <!-- Header -->
            <TextBlock Text="FlexRadio CW Keyer"
                       FontSize="24" FontWeight="Bold"
                       HorizontalAlignment="Center"/>

            <!-- Setup Page -->
            <StackPanel Spacing="15" IsVisible="{Binding IsSetupPage}">

                <!-- Radio Selection -->
                <Border BorderBrush="Gray" BorderThickness="1" Padding="15" CornerRadius="5">
                    <StackPanel Spacing="10">
                        <TextBlock Text="Radio Selection" FontWeight="Bold" FontSize="16"/>

                        <StackPanel Orientation="Horizontal" Spacing="10">
                            <TextBlock Text="Radio + Client:" VerticalAlignment="Center" Width="100"/>
                            <ComboBox Name="RadioComboBox"
                                      ItemsSource="{Binding RadioClientSelections}"
                                      SelectedItem="{Binding SelectedRadioClient}"
                                      Width="400"
                                      PlaceholderText="Select a radio and GUI client..."/>
                            <Button Content="Refresh"
                                    Command="{Binding RefreshRadiosCommand}"
                                    Width="80"/>
                        </StackPanel>

                        <StackPanel Orientation="Horizontal" Spacing="10">
                            <TextBlock Text="Status:" VerticalAlignment="Center" Width="100"/>
                            <TextBlock Text="{Binding RadioStatus}"
                                       VerticalAlignment="Center"
                                       Foreground="{Binding RadioStatusColor}"/>
                        </StackPanel>
                    </StackPanel>
                </Border>

                <!-- Input Device Selection -->
                <Border BorderBrush="Gray" BorderThickness="1" Padding="15" CornerRadius="5">
                    <StackPanel Spacing="10">
                        <TextBlock Text="Input Device Selection" FontWeight="Bold" FontSize="16"/>

                        <!-- Input Type Selector -->
                        <StackPanel Spacing="5">
                            <TextBlock Text="Input Type:"/>
                            <StackPanel Orientation="Horizontal" Spacing="20">
                                <RadioButton Content="Serial Port (HaliKey)"
                                             GroupName="InputType"
                                             IsChecked="{Binding IsSerialInput}"/>
                                <RadioButton Content="MIDI Device"
                                             GroupName="InputType"
                                             IsChecked="{Binding IsMidiInput}"/>
                            </StackPanel>
                        </StackPanel>

                        <!-- Serial Port Settings -->
                        <StackPanel Spacing="10" IsVisible="{Binding IsSerialInput}">
                            <StackPanel Orientation="Horizontal" Spacing="10">
                                <TextBlock Text="HaliKey Version:" VerticalAlignment="Center" Width="120"/>
                                <ComboBox ItemsSource="{Binding HaliKeyVersions}"
                                          SelectedItem="{Binding SelectedHaliKeyVersion}"
                                          Width="200"/>
                            </StackPanel>

                            <StackPanel Orientation="Horizontal" Spacing="10">
                                <TextBlock Text="Port:" VerticalAlignment="Center" Width="120"/>
                                <ComboBox ItemsSource="{Binding SerialPorts}"
                                          SelectedItem="{Binding SelectedSerialPort}"
                                          Width="250"
                                          PlaceholderText="Select a port..."/>
                                <Button Content="Refresh"
                                        Command="{Binding RefreshSerialPortsCommand}"
                                        Width="80"/>
                            </StackPanel>
                        </StackPanel>

                        <!-- MIDI Device Settings -->
                        <StackPanel Spacing="10" IsVisible="{Binding IsMidiInput}">
                            <StackPanel Orientation="Horizontal" Spacing="10">
                                <TextBlock Text="MIDI Device:" VerticalAlignment="Center" Width="120"/>
                                <ComboBox ItemsSource="{Binding MidiDevices}"
                                          SelectedItem="{Binding SelectedMidiDevice}"
                                          Width="250"
                                          PlaceholderText="Select a MIDI device..."/>
                                <Button Content="Refresh"
                                        Command="{Binding RefreshMidiDevicesCommand}"
                                        Width="80"/>
                            </StackPanel>

                            <TextBlock Text="Note: MIDI uses Note 20 (Left Paddle) and Note 21 (Right Paddle)"
                                       FontSize="11"
                                       Foreground="Gray"/>
                        </StackPanel>
                    </StackPanel>
                </Border>

                <!-- Connect Button -->
                <Button Content="Connect"
                        Command="{Binding ToggleConnectionCommand}"
                        HorizontalAlignment="Center"
                        Width="150"
                        Margin="0,10,0,0"/>
            </StackPanel>

            <!-- Operating Page -->
            <StackPanel Spacing="15" IsVisible="{Binding IsOperatingPage}">

                <!-- Paddle Status -->
                <Border BorderBrush="Gray" BorderThickness="1" Padding="15" CornerRadius="5">
                    <StackPanel Spacing="10">
                        <TextBlock Text="Paddle Status" FontWeight="Bold" FontSize="16"/>

                        <StackPanel Orientation="Horizontal" Spacing="20" HorizontalAlignment="Center">
                            <!-- Left Paddle Indicator -->
                            <StackPanel Spacing="5">
                                <TextBlock Text="Left Paddle" FontSize="12" FontWeight="Bold" HorizontalAlignment="Center"/>
                                <Border Width="100" Height="50"
                                        Background="{Binding LeftPaddleIndicatorColor}"
                                        BorderBrush="DarkGray"
                                        BorderThickness="2"
                                        CornerRadius="3">
                                    <TextBlock Text="{Binding LeftPaddleStateText}"
                                               HorizontalAlignment="Center"
                                               VerticalAlignment="Center"
                                               Foreground="White"
                                               FontWeight="Bold"
                                               FontSize="16"/>
                                </Border>
                            </StackPanel>

                            <!-- Right Paddle Indicator -->
                            <StackPanel Spacing="5">
                                <TextBlock Text="Right Paddle" FontSize="12" FontWeight="Bold" HorizontalAlignment="Center"/>
                                <Border Width="100" Height="50"
                                        Background="{Binding RightPaddleIndicatorColor}"
                                        BorderBrush="DarkGray"
                                        BorderThickness="2"
                                        CornerRadius="3">
                                    <TextBlock Text="{Binding RightPaddleStateText}"
                                               HorizontalAlignment="Center"
                                               VerticalAlignment="Center"
                                               Foreground="White"
                                               FontWeight="Bold"
                                               FontSize="16"/>
                                </Border>
                            </StackPanel>
                        </StackPanel>
                    </StackPanel>
                </Border>

                <!-- CW Settings Section -->
                <Border BorderBrush="Gray" BorderThickness="1" Padding="15" CornerRadius="5">
                    <StackPanel Spacing="10">
                        <TextBlock Text="CW Settings" FontWeight="Bold" FontSize="16"/>

                        <!-- Speed -->
                        <StackPanel Orientation="Horizontal" Spacing="10">
                            <TextBlock Text="Speed (WPM):" Width="120" VerticalAlignment="Center"/>
                            <TextBlock Text="{Binding CwSpeed}" Width="30" VerticalAlignment="Center"/>
                            <Slider Minimum="5" Maximum="60"
                                    Value="{Binding CwSpeed}"
                                    TickFrequency="5"
                                    Width="300"
                                    VerticalAlignment="Center"/>
                        </StackPanel>

                        <!-- Sidetone Volume -->
                        <StackPanel Orientation="Horizontal" Spacing="10">
                            <TextBlock Text="Sidetone Volume:" Width="120" VerticalAlignment="Center"/>
                            <TextBlock Text="{Binding SidetoneVolume}" Width="30" VerticalAlignment="Center"/>
                            <Slider Minimum="0" Maximum="100"
                                    Value="{Binding SidetoneVolume}"
                                    TickFrequency="10"
                                    Width="300"
                                    VerticalAlignment="Center"/>
                        </StackPanel>

                        <!-- Pitch -->
                        <StackPanel Orientation="Horizontal" Spacing="10">
                            <TextBlock Text="Pitch (Hz):" Width="120" VerticalAlignment="Center"/>
                            <TextBlock Text="{Binding CwPitch}" Width="30" VerticalAlignment="Center"/>
                            <Slider Minimum="300" Maximum="1000"
                                    Value="{Binding CwPitch}"
                                    TickFrequency="50"
                                    Width="300"
                                    VerticalAlignment="Center"/>
                        </StackPanel>

                        <!-- Mode Selection -->
                        <StackPanel Spacing="5">
                            <TextBlock Text="Keyer Mode:"/>
                            <StackPanel Orientation="Horizontal" Spacing="20">
                                <RadioButton Content="Iambic"
                                             GroupName="KeyerMode"
                                             IsChecked="{Binding IsIambicMode}"/>
                                <RadioButton Content="Straight Key"
                                             GroupName="KeyerMode"
                                             IsChecked="{Binding !IsIambicMode}"/>
                            </StackPanel>
                        </StackPanel>

                        <!-- Iambic Mode Selection (A vs B) -->
                        <StackPanel Spacing="5">
                            <TextBlock Text="Iambic Type:"/>
                            <StackPanel Orientation="Horizontal" Spacing="20">
                                <RadioButton Content="Mode A"
                                             GroupName="IambicType"
                                             IsChecked="{Binding !IsIambicModeB}"
                                             IsEnabled="{Binding IsIambicMode}"/>
                                <RadioButton Content="Mode B"
                                             GroupName="IambicType"
                                             IsChecked="{Binding IsIambicModeB}"
                                             IsEnabled="{Binding IsIambicMode}"/>
                            </StackPanel>
                        </StackPanel>

                        <!-- Swap Paddles -->
                        <StackPanel Spacing="5">
                            <CheckBox Content="Swap Paddles (Left â†” Right)"
                                      IsChecked="{Binding SwapPaddles}"/>
                        </StackPanel>
                    </StackPanel>
                </Border>

                <!-- Disconnect Button -->
                <Button Content="Disconnect"
                        Command="{Binding ToggleConnectionCommand}"
                        HorizontalAlignment="Center"
                        Width="150"
                        Margin="0,10,0,0"/>
            </StackPanel>

            <!-- Exit Button (always visible) -->
            <Button Content="Exit"
                    Command="{Binding ExitCommand}"
                    HorizontalAlignment="Center"
                    Width="120"
                    Margin="0,10,0,0"/>

        </StackPanel>
    </ScrollViewer>

</Window>
